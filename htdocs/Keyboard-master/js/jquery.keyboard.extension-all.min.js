/*! jQuery.mousewheel.js Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net) MIT License
 * Version: 3.0.6 Requires: 1.2.2+ */
;(function(d){function e(a){var b=a||window.event,c=[].slice.call(arguments,1),f=0,e=0,g=0;a=d.event.fix(b);a.type="mousewheel";b.wheelDelta&&(f=b.wheelDelta/120);b.detail&&(f=-b.detail/3);g=f;void 0!==b.axis&&b.axis===b.HORIZONTAL_AXIS&&(g=0,e=-1*f);void 0!==b.wheelDeltaY&&(g=b.wheelDeltaY/120);void 0!==b.wheelDeltaX&&(e=-1*b.wheelDeltaX/120);c.unshift(a,f,e,g);return(d.event.dispatch||d.event.handle).apply(this,c)}var c=["DOMMouseScroll","mousewheel"];if(d.event.fixHooks)for(var h=c.length;h;)d.event.fixHooks[c[--h]]= d.event.mouseHooks;d.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=c.length;a;)this.addEventListener(c[--a],e,!1);else this.onmousewheel=e},teardown:function(){if(this.removeEventListener)for(var a=c.length;a;)this.removeEventListener(c[--a],e,!1);else this.onmousewheel=null}};d.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery);

/* jQuery UI Virtual Keyboard Extensions ~ https://github.com/Mottie/Keyboard * By Rob Garrison ~ MIT license */
/* Autocomplete v1.6 for Keyboard v1.18+ only (11/19/2014) */
(function(b){b.fn.addAutocomplete=function(){return this.each(function(){var a=b(this).data("keyboard");a&&(a.autocomplete_new_version=function(a){a[0]=parseInt(a[0],10);return 1<a[0]||1===a[0]&&9<=parseInt(a[1],10)}(b.ui.version.split(".")),a.autocomplete_init=function(){a.options.alwaysOpen&&a.isVisible()&&a.autocomplete_setup();a.$el.bind("visible.keyboard",function(){a.autocomplete_setup()}).bind("change.keyboard",function(){a.hasAutocomplete&&a.isVisible()&&a.$el.val(a.$preview.val()).trigger("keydown.autocomplete")}).bind("hidden.keyboard", function(){a.$el.autocomplete("close")}).bind("autocompleteopen",function(){a.hasAutocomplete&&a.$autocomplete.menu.element.position({of:a.$keyboard,my:"right top",at:"left top",collision:"flip"})}).bind("autocompleteselect",function(c,b){var d=b.item&&b.item.value||"";a.hasAutocomplete&&""!==d&&(a.$preview.val(d).focus(),a.lastCaret={start:d.length,end:d.length})})},a.autocomplete_setup=function(){a.$autocomplete=a.$el.data("autocomplete")||a.$el.data("uiAutocomplete")||a.$el.data("ui-autocomplete"); a.hasAutocomplete="undefined"===typeof a.$autocomplete?!1:a.$autocomplete.options.disabled?!1:!0;a.hasAutocomplete&&(a.$preview.bind("keydown",function(b){a.$el.val(a.$preview.val()).triggerHandler(b)}),a.$allKeys.bind("mouseup mousedown mouseleave touchstart touchend touchcancel",function(){clearTimeout(a.$autocomplete.searching);a.$autocomplete.searching=setTimeout(function(){a.$autocomplete.term!==a.$autocomplete.element.val()&&(a.$autocomplete.selectedItem=null,a.$autocomplete.search(null,event))}, a.$autocomplete.options.delay)}))},a.origEscClose=a.escClose,a.escClose=function(c){a.hasAutocomplete&&("ui-active-menuitem"===c.target.id||b(c.target).closest("ul").hasClass("ui-autocomplete"))||a.origEscClose(c)},a.autocomplete_init())})}})(jQuery);

/* jQuery Mobile Themes v1.2 for keyboard v1.18+ (updated 6/1/2014) */
(function(d){d.fn.addMobile=function(f){var b,g={container:{theme:"b",cssClass:"ui-body"},input:{theme:"b",cssClass:""},buttonMarkup:{theme:"b",cssClass:"ui-btn",shadow:"true",corners:"true"},buttonHover:{theme:"b",cssClass:"ui-btn-hover"},buttonAction:{theme:"b",cssClass:"ui-btn-active"},buttonActive:{theme:"b",cssClass:"ui-btn-active"}};return this.each(function(){var a=d(this).data("keyboard");a&&"undefined"!==typeof d.fn.textinput&&(a.mobile_options=b=d.extend(!0,{},g,f),a.mobile_init=function(){d(".ui-keyboard-input").textinput(); a.options.alwaysOpen&&a.isVisible&&a.mobile_setup();a.$el.on("beforeVisible.keyboard",function(){a.$keyboard.css("visibility","hidden")}).on("visible.keyboard",function(){a.mobile_setup();a.$keyboard.css("visibility","visible");a.$preview.focus()})},a.mobile_setup=function(){var c;c=a.options;var e=b.buttonMarkup.cssClass||"",f=c.css.buttonAction;c.css.buttonAction+=" "+b.buttonAction.cssClass;a.$keyboard.addClass(a.modOptions(b.container,b.container)).find(".ui-keyboard-preview").addClass(a.modOptions(b.input, b.input)).end().removeClass("ui-widget ui-widget-content").find("."+f).addClass(a.modOptions(b.buttonAction,b.buttonMarkup)).end().find("button").removeClass("ui-corner-all ui-state-default").addClass(a.modOptions(b.buttonMarkup)).hover(function(){d(this).removeClass(e?e+"-"+b.buttonMarkup.theme:"").addClass(a.modOptions(b.buttonHover,b.buttonMarkup))},function(){d(this).removeClass(e?e+"-"+b.buttonHover.theme:"").addClass(a.modOptions(b.buttonMarkup,b.buttonMarkup))});a.msie&&a.$preview[0]!==a.el&& (a.$preview.hide(),a.$keyboard.css("width",""),a.width=a.$keyboard.outerWidth(),a.$keyboard.width(a.width+parseInt(a.$preview.css("fontSize"),10)),a.$preview.width(a.width),a.$preview.show());d.ui&&d.ui.position&&(c=c.position,c.of=c.of||a.$el.data("keyboardPosition")||a.$el,c.collision=c.collision||"flipfit flipfit",a.$keyboard.position(c))},a.modOptions=function(a,b){return" "+(a.cssClass||"")+" "+(b&&b.cssClass?b.cssClass+"-"+(a.theme||""):"")+("true"==a.shadow?" ui-shadow":"")+("true"==a.corners? " ui-corner-all":"")},a.mobile_init())})}})(jQuery);

/* Navigation v1.4 for Keyboard v1.18+ only (updated 3/1/2014) */
(function(e){e.keyboard=e.keyboard||{};e.keyboard.navigationKeys={toggle:112,enter:13,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,caretrt:45,caretlt:46};e.fn.addNavigation=function(n){return this.each(function(){var c,k,a=e(this).data("keyboard");k={position:[0,0],toggleMode:!1,focusClass:"hasFocus"};a&&(a.navigation_options=c=e.extend({},k,n),a.navigation_keys=k=e.extend({},e.keyboard.navigationKeys),a.saveNav=[a.options.tabNavigation,a.options.enterNavigation],a.allNavKeys= e.map(k,function(a,b){return a}),a.navigation_init=function(){a.$keyboard.toggleClass(c.focusClass,c.toggleMode).find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+c.position[0]+","+c.position[1]+'"]').addClass("ui-state-hover");a.$preview.unbind("keydown.keyboardNav").bind("keydown.keyboardNav",function(c){return a.checkKeys(c.which)})},a.checkKeys=function(h,b){if("undefined"!==typeof h){var d=a.navigation_keys;if(h===d.toggle||b)c.toggleMode=b?!1:!c.toggleMode,a.options.tabNavigation= c.toggleMode?!1:a.saveNav[0],a.options.enterNavigation=c.toggleMode?!1:a.saveNav[1];a.$keyboard.toggleClass(c.focusClass,c.toggleMode);if(c.toggleMode&&h===d.enter)return a.$keyboard.find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+c.position[0]+","+c.position[1]+'"]').trigger("repeater.keyboard"),!1;if(c.toggleMode&&0<=e.inArray(h,a.allNavKeys))return a.navigateKeys(h),!1}},a.navigateKeys=function(h,b,d){d=d||c.position[1];b=b||c.position[0];var e=a.$keyboard.find(".ui-keyboard-keyset:visible"), k=e.find(".ui-keyboard-button-endrow").length-1,l=e.find('.ui-keyboard-button[data-pos^="'+b+',"]').length-1,g=a.lastCaret,m=a.$preview.val().length,f=a.navigation_keys;switch(h){case f.pageup:b=0;break;case f.pagedown:b=k;break;case f.end:d=l;break;case f.home:d=0;break;case f.left:d+=0<d?-1:0;break;case f.up:b+=0<b?-1:0;break;case f.right:d+=1;break;case f.down:b+=b+1>k?0:1;break;case f.caretRt:g.start++;break;case f.caretLt:g.start--}if(h===f.caretRt||h===f.caretLt)g.start=0>g.start?0:g.start> m?m:g.start,g.end=g.start,a.lastCaret=g,a.$preview.focus().caret(g.start,g.start);l=e.find('.ui-keyboard-button[data-pos^="'+b+',"]').length-1;d>l&&(d=l);e.find(".ui-state-hover").removeClass("ui-state-hover");e.find('.ui-keyboard-button[data-pos="'+b+","+d+'"]').addClass("ui-state-hover");c.position=[b,d]},a.options.alwaysOpen&&a.isVisible&&(a.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover"),a.navigation_init()),a.$el.bind("visible.keyboard",function(c){a.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover"); a.navigation_init()}).bind("inactive.keyboard hidden.keyboard",function(c){a.checkKeys(c.which,!0)}).bind("navigate navigateTo",function(c,b,d){b=isNaN(b)?b.toLowerCase():b;a.navigation_keys.hasOwnProperty(b)?a.checkKeys(a.navigation_keys[b]):a.navigateKeys(null,b,d)}))})}})(jQuery);

/* Scramble Extension v1.4 for Keyboard v1.18+ (updated 11/19/2014) */
(function(c){c.keyboard=c.keyboard||{};c.fn.addScramble=function(t){var u={targetKeys:/[a-z\d]/i,byRow:!0,byKeySet:!1,randomizeOnce:!0};return this.each(function(){var e,a=c(this).data("keyboard"),q=a.options;a&&!a.scramble_options&&(e=a.scramble_options=c.extend({},u,t),a.scramble_setup=function(g){var r,k,d,b,l,m,f,p,s,n,h;r=g.find(".ui-keyboard-keyset");if(g.length){e.byKeySet&&(r=r.eq(0));for(k=0;k<r.length;k++)if(d=r.eq(k),f=0,h=[],s=[],p=[],n=[],d.children("button, span, br").each(function(){"BR"=== this.tagName?(e.byRow?(h.push(this),s.push(!1),n[f]=h,p[f]=s,h=[],s=[]):(n[f]=this,p[f]=!1),f++):(m=c(this).attr("data-value")||"",m=1===m.length&&e.targetKeys.test(m)?m:!1,e.byRow?(h.push(this),s.push(m)):(n[f]=this,p[f]=m,f++))}),d.find(".ui-keyboard-button-endrow").remove(),e.byRow)for(l=0;l<n.length;l++)for(h=a.shuffle(n[l],p[l]),b=0;b<h.length;b++)d.append(h[b]);else for(h=a.shuffle(n,p),b=0;b<h.length;b++)d.append(h[b]);e.byKeySet&&(g=a.realign(g));return g}},a.shuffle=function(a,c){for(var k, d,b=a.length;0<b;)d=Math.floor(Math.random()*b),!1===c[b-1]&&b--,!1!==c[b-1]&&!1!==c[d]&&(b--,k=a[b],a[b]=a[d],a[d]=k);return a},a.realign=function(a){var e,k,d,b=a.find(".ui-keyboard-keyset"),l=b.eq(0),b=b.filter(":gt(0)");l.children().each(function(a,f){k="BR"===f.tagName;d=c(f).attr("data-pos");b.each(function(a,b){e=k?"br:first":'button[data-pos="'+d+'"]';c(b).find(e).appendTo(b)})});return a},q.create=function(){var g=q.layout;c.keyboard.builtLayouts[g]={mappedKeys:{},acceptedKeys:[],$keyboard:null}; "undefined"===typeof c.keyboard.builtLayouts[a.orig_layout]&&(a.layout=q.layout=a.orig_layout,a.buildKeyboard(),a.layout=q.layout=g);c.keyboard.builtLayouts[g]=c.extend(!0,{},c.keyboard.builtLayouts[a.orig_layout]);e.randomizeOnce&&(c.keyboard.builtLayouts[g].$keyboard=a.scramble_setup(c.keyboard.builtLayouts[a.orig_layout].$keyboard.clone()));a.$keyboard=c.keyboard.builtLayouts[g].$keyboard;e.randomizeOnce||a.$el.bind("beforeVisible.keyboard",function(a,c){c.$keyboard=c.scramble_setup(c.$keyboard)})}, /^scrambled/.test(a.options.layout)||(a.orig_layout=a.options.layout,a.options.layout="scrambled"+Math.round(1E4*Math.random())),q.alwaysOpen&&a.$keyboard.length&&setTimeout(function(){a.$keyboard=a.scramble_setup(a.$keyboard)},0))})}})(jQuery);

/* Typing Simulator v1.6 for Keyboard v1.18+ only (1/3/2015) */
(function(h){h.fn.addTyping=function(k){var l={showTyping:!0,lockTypeIn:!1,delay:250};return this.each(function(){var b,a=h(this).data("keyboard");a&&(b=a.typing_options=h.extend({},l,k),a.typing_keymap={" ":"space",'"':"34","'":"39","&nbsp;":"space","\b":"bksp","\n":"Enter","\r":"Enter","\t":"tab"},a.typing_xref={8:"bksp",9:"tab",13:"enter",32:"space"},a.typing_event=!1,b.savedLockInput=a.options.lockInput,a.typing_setup=function(){(a.$preview?a.$preview:a.$el).bind("keyup.keyboard",function(c){if(b.init&& b.lockTypeIn)return!1;37<=c.which&&40>=c.which||(16===c.which&&(a.shiftActive=!1),18===c.which&&(a.altActive=!1),16!==c.which&&18!==c.which)||(a.showKeySet(),setTimeout(function(){a.$preview.focus()},200))}).bind("keydown.keyboard",function(c){if(b.init&&b.lockTypeIn)return!1;c.temp=!1;16===c.which&&(c.temp=!a.shiftActive,a.shiftActive=!0);18===c.which&&(c.temp=!a.altActive,a.altActive=!0);c.temp&&(a.showKeySet(),a.$preview.focus());a.typing_event=!0;8!==c.which&&9!==c.which||a.typing_findKey("", c)}).bind("keypress.keyboard",function(c){if(b.init&&b.lockTypeIn)return!1;a.typing_event&&!a.options.lockInput&&a.typing_findKey("",c)})},a.typeIn=function(c,e,f,d){a.isVisible()?a.typing_event?"undefined"===typeof c&&(a.typing_event=!1,a.options.lockInput=b.savedLockInput):(!0!==b.init&&(b.init=!0,a.options.lockInput=b.lockTypeIn,c=b.text=c||"",b.len=c.length-1,b.delay=e||300,b.current=0,f&&(b.callback=f)),c=b.text.substring(b.current,++b.current),a.typing_findKey(c,d)):(a.typing_event=b.init=!1, a.options.lockInput=b.savedLockInput,clearTimeout(a.typing_timer))},a.typing_findKey=function(c,e){var f,d,g;d=h.keyboard.builtLayouts[a.layout].mappedKeys;g=a.$keyboard.find(".ui-keyboard-keyset");f='.ui-keyboard-button[data-value="'+(a.typing_keymap.hasOwnProperty(c)?a.typing_keymap[c]:c)+'"]';a.typing_event&&e&&(a.typing_xref.hasOwnProperty(e.keyCode||e.which)?f=".ui-keyboard-"+a.typing_xref[e.keyCode||e.which]:(f=String.fromCharCode(e.charCode||e.which),f=d.hasOwnProperty(f)?'.ui-keyboard-button[data-value="'+ d[f]+'"]':".ui-keyboard-"+(e.charCode||e.which)));d=g.filter(":visible").find(f);d.length?a.typing_simulateKey(d,c):(a.typing_event?d=g.find(f):(d=a.typing_keymap.hasOwnProperty(c)?a.typing_keymap[c]:c.charCodeAt(0),"bksp"===d&&(c=d),d=g.find(".ui-keyboard-"+d)),g=d.closest(".ui-keyboard-keyset"),g.attr("name")?(g=g.attr("name"),a.shiftActive=/shift/.test(g),a.altActive=/alt/.test(g),a.metaActive=a.last.keyset[2]=g.match(/meta\d+/)||!1,a.showKeySet({name:a.metaActive}),a.typing_simulateKey(d,c)): a.typing_event||(a.insertText(c),a.checkCombos()));b.current<=b.len&&0!==b.len?a.isVisible()&&setTimeout(function(){a.typeIn()},b.delay):0!==b.len?(a.typing_event=b.init=!1,a.options.lockInput=b.savedLockInput,b.len=b.current=0,h.isFunction(b.callback)&&setTimeout(function(){h.isFunction(b.callback)&&b.callback(a)},b.delay)):(b.len=b.current=0,b.text="",a.typing_event=b.init=!1,a.options.lockInput=b.savedLockInput)},a.typing_simulateKey=function(c,e){c.length&&c.filter(":visible").trigger("mouseenter.keyboard"); a.typing_timer=setTimeout(function(){c.length&&setTimeout(function(){c.trigger("mouseleave.keyboard")},b.delay/3);a.isVisible()&&!a.typing_event&&(a.insertText(e),a.checkCombos())},b.delay/3)},b.showTyping&&(a.options.alwaysOpen&&a.isVisible()&&a.typing_setup(),a.$el.bind("visible.keyboard",function(){a.typing_setup()})))})}})(jQuery);
