/* jQuery UI Virtual Keyboard Scramble Extension v1.4 for Keyboard v1.18+ (updated 11/19/2014)
 * By Rob Garrison ~ MIT license ~ https://github.com/Mottie/Keyboard */
;(function(c){c.keyboard=c.keyboard||{};c.fn.addScramble=function(t){var u={targetKeys:/[a-z\d]/i,byRow:!0,byKeySet:!1,randomizeOnce:!0};return this.each(function(){var e,a=c(this).data("keyboard"),q=a.options;a&&!a.scramble_options&&(e=a.scramble_options=c.extend({},u,t),a.scramble_setup=function(g){var r,k,d,b,l,m,f,p,s,n,h;r=g.find(".ui-keyboard-keyset");if(g.length){e.byKeySet&&(r=r.eq(0));for(k=0;k<r.length;k++)if(d=r.eq(k),f=0,h=[],s=[],p=[],n=[],d.children("button, span, br").each(function(){"BR"=== this.tagName?(e.byRow?(h.push(this),s.push(!1),n[f]=h,p[f]=s,h=[],s=[]):(n[f]=this,p[f]=!1),f++):(m=c(this).attr("data-value")||"",m=1===m.length&&e.targetKeys.test(m)?m:!1,e.byRow?(h.push(this),s.push(m)):(n[f]=this,p[f]=m,f++))}),d.find(".ui-keyboard-button-endrow").remove(),e.byRow)for(l=0;l<n.length;l++)for(h=a.shuffle(n[l],p[l]),b=0;b<h.length;b++)d.append(h[b]);else for(h=a.shuffle(n,p),b=0;b<h.length;b++)d.append(h[b]);e.byKeySet&&(g=a.realign(g));return g}},a.shuffle=function(a,c){for(var k, d,b=a.length;0<b;)d=Math.floor(Math.random()*b),!1===c[b-1]&&b--,!1!==c[b-1]&&!1!==c[d]&&(b--,k=a[b],a[b]=a[d],a[d]=k);return a},a.realign=function(a){var e,k,d,b=a.find(".ui-keyboard-keyset"),l=b.eq(0),b=b.filter(":gt(0)");l.children().each(function(a,f){k="BR"===f.tagName;d=c(f).attr("data-pos");b.each(function(a,b){e=k?"br:first":'button[data-pos="'+d+'"]';c(b).find(e).appendTo(b)})});return a},q.create=function(){var g=q.layout;c.keyboard.builtLayouts[g]={mappedKeys:{},acceptedKeys:[],$keyboard:null}; "undefined"===typeof c.keyboard.builtLayouts[a.orig_layout]&&(a.layout=q.layout=a.orig_layout,a.buildKeyboard(),a.layout=q.layout=g);c.keyboard.builtLayouts[g]=c.extend(!0,{},c.keyboard.builtLayouts[a.orig_layout]);e.randomizeOnce&&(c.keyboard.builtLayouts[g].$keyboard=a.scramble_setup(c.keyboard.builtLayouts[a.orig_layout].$keyboard.clone()));a.$keyboard=c.keyboard.builtLayouts[g].$keyboard;e.randomizeOnce||a.$el.bind("beforeVisible.keyboard",function(a,c){c.$keyboard=c.scramble_setup(c.$keyboard)})}, /^scrambled/.test(a.options.layout)||(a.orig_layout=a.options.layout,a.options.layout="scrambled"+Math.round(1E4*Math.random())),q.alwaysOpen&&a.$keyboard.length&&setTimeout(function(){a.$keyboard=a.scramble_setup(a.$keyboard)},0))})}})(jQuery);
